name: smoke tests

# only build on merges to main
on:
  push:
    branches:
    - main
  schedule:
    # Run every Sunday
    - cron: '0 0 * * 0'
  workflow_dispatch:

jobs:
  test:
    name: smoke-tests
    runs-on: ubuntu-latest
    env:
      PKGNET_SUPPRESS_BROWSER: 0
    strategy:
      max-parallel: 8 # Let's be reasonable
      matrix: 
        test_pkg: [rcmdcheck, covr, assertthat, data.table, DT, futile.logger,glue, igraph, knitr, magrittr, R6, rlang, rmarkdown, visNetwork]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
      - name: set up R
        uses: r-lib/actions/setup-r@v2
        with:
          r-version: 'release'
      - name: Install Tidy
        run: sudo apt install -y tidy 
      - name: Install Deps For Pkgnet & ${{ matrix.test_pkg }}
        uses: r-lib/actions/setup-r-dependencies@v2
        with:
          extra-packages: ${{ matrix.test_pkg }}, local::.
      - name: run smoke test
        shell: Rscript {0}
        run: "pkgnet::CreatePackageReport(pkg_name='${{ matrix.test_pkg }}', report_path='${{ github.workspace }}/${{ matrix.test_pkg }}_report.html')"